# For a comparison of  6 V.dahliaerace2 strains, 1 race1 strain and 1 V.alfafae isolates



# Methodology 4


```bash
  ProjDir=/home/groups/harrisonlab/project_files/verticillium_dahliae/pathogenomics
  cd $ProjDir
  IsolateAbrv=All_Strains
  WorkDir=analysis/orthology/orthomcl/$IsolateAbrv
  mkdir -p $WorkDir
  mkdir -p $WorkDir/formatted
  mkdir -p $WorkDir/goodProteins
  mkdir -p $WorkDir/badProteins  
```
## 4.1 Format fasta files

### 4.1.a Race2 isolates:

### for 12008
```bash
  Taxon_code=12008
  Fasta_file=$(ls gene_pred/final_genes/V.dahliae/12008/final/final_genes_combined.pep.fasta)
  Id_field=1
  orthomclAdjustFasta $Taxon_code $Fasta_file $Id_field
  mv "$Taxon_code".fasta $WorkDir/formatted/"$Taxon_code".fasta
```

### for 51
```bash
  Taxon_code=51
  Fasta_file=$(ls gene_pred/final_genes/V.dahliae/51/final/final_genes_combined.pep.fasta)
  Id_field=1
  orthomclAdjustFasta $Taxon_code $Fasta_file $Id_field
  mv "$Taxon_code".fasta $WorkDir/formatted/"$Taxon_code".fasta
```

### for 53
```bash
  Taxon_code=53
  Fasta_file=$(ls gene_pred/final_genes/V.dahliae/53/final/final_genes_combined.pep.fasta)
  Id_field=1
  orthomclAdjustFasta $Taxon_code $Fasta_file $Id_field
  mv "$Taxon_code".fasta $WorkDir/formatted/"$Taxon_code".fasta
```
### for 58
```bash
  Taxon_code=58
  Fasta_file=$(ls gene_pred/final_genes/V.dahliae/58/final/final_genes_combined.pep.fasta)
  Id_field=1
  orthomclAdjustFasta $Taxon_code $Fasta_file $Id_field
  mv "$Taxon_code".fasta $WorkDir/formatted/"$Taxon_code".fasta
```

### for 61
```bash
  Taxon_code=61
  Fasta_file=$(ls gene_pred/final_genes/V.dahliae/61/final/final_genes_combined.pep.fasta)
  Id_field=1
  orthomclAdjustFasta $Taxon_code $Fasta_file $Id_field
  mv "$Taxon_code".fasta $WorkDir/formatted/"$Taxon_code".fasta
```

### for Ls17
```bash
  Taxon_code=Ls17
  Fasta_file=$(ls gene_pred/final_genes/V.dahliae/Ls17/final/Verticillium_dahliae.ASM15067v2.pep.all.fa)
  Id_field=1
  orthomclAdjustFasta $Taxon_code $Fasta_file $Id_field
  mv "$Taxon_code".fasta $WorkDir/formatted/"$Taxon_code".fasta
```

### 4.1.b Race1 isolate:

### for JR2
```bash
  Taxon_code=JR2
  Fasta_file=$(ls gene_pred/final_genes/V.dahliae/JR2/final/Verticillium_dahliaejr2.GCA_000400815.2.pep.all.fa)
  Id_field=1
  orthomclAdjustFasta $Taxon_code $Fasta_file $Id_field
  mv "$Taxon_code".fasta $WorkDir/formatted/"$Taxon_code".fasta
```
### 4.1.c V.alfafae isolate:

### for VaMs102
```bash
  Taxon_code=VaMs102
  Fasta_file=$(ls gene_pred/final_genes/V.alfafae/VaMs102/final/Verticillium_alfalfae_vams_102.ASM15082v1.pep.all.fa)
  Id_field=1
  orthomclAdjustFasta $Taxon_code $Fasta_file $Id_field
  mv "$Taxon_code".fasta $WorkDir/formatted/"$Taxon_code".fasta
```
## 4.2 Filter proteins into good and poor sets.

```bash
  Input_dir=$WorkDir/formatted
  Min_length=10
  Max_percent_stops=20
  Good_proteins_file=$WorkDir/goodProteins/goodProteins.fasta
  Poor_proteins_file=$WorkDir/badProteins/poorProteins.fasta
  orthomclFilterFasta $Input_dir $Min_length $Max_percent_stops $Good_proteins_file $Poor_proteins_file
```
## 4.3.a Perform an all-vs-all blast of the proteins

```bash
  BlastDB=$WorkDir/blastall/$IsolateAbrv.db

  makeblastdb -in $Good_proteins_file -dbtype prot -out $BlastDB
  BlastOut=$WorkDir/all-vs-all_results.tsv
  mkdir -p $WorkDir/splitfiles

  SplitDir=/home/armita/git_repos/emr_repos/tools/seq_tools/feature_annotation/signal_peptides
  $SplitDir/splitfile_500.py --inp_fasta $Good_proteins_file --out_dir $WorkDir/splitfiles --out_base goodProteins

  ProgDir=/home/armita/git_repos/emr_repos/scripts/phytophthora/pathogen/orthology  
  for File in $(find $WorkDir/splitfiles); do
    Jobs=$(qstat | grep 'blast_500' | grep 'qw' | wc -l)
    while [ $Jobs -gt 1 ]; do
    sleep 3
    printf "."
    Jobs=$(qstat | grep 'blast_500' | grep 'qw' | wc -l)
    done
    printf "\n"
    echo $File
    BlastOut=$(echo $File | sed 's/.fa/.tab/g')
    qsub $ProgDir/blast_500.sh $BlastDB $File $BlastOut
  done
```

## 4.3.b Merge the all-vs-all blast results  
```bash  
  MergeHits="$IsolateAbrv"_blast.tab
  printf "" > $MergeHits
  for Num in $(ls $WorkDir/splitfiles/*.tab | rev | cut -f1 -d '_' | rev | sort -n); do
    File=$(ls $WorkDir/splitfiles/*_$Num)
    cat $File
  done > $MergeHits
```
## 4.4 Perform ortholog identification

```bash
  ProgDir=/home/armita/git_repos/emr_repos/tools/pathogen/orthology/orthoMCL
  MergeHits="$IsolateAbrv"_blast.tab
  GoodProts=$WorkDir/goodProteins/goodProteins.fasta
  qsub $ProgDir/qsub_orthomcl.sh $MergeHits $GoodProts 5
```


## 4.5.a Manual identification of numbers of orthologous and unique genes
```bash
for num in 1; do
echo "The total number of orthogroups is:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | wc -l
echo "The total number of genes in orthogroups is:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep -o '|' | wc -l

echo "The number of orthogroups common to V.dahliae strains is:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep -v 'VaMs102|' | grep '12008|' | grep '51|' | grep '53|' | grep '58|' | grep '61|' | grep 'Ls17|' | grep 'JR2|' | wc -l
echo "This represents the following number of genes:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep -v 'VaMs102|' | grep '12008|' | grep '51|' | grep '53|' | grep '58|' | grep '61|' | grep 'Ls17|' | grep 'JR2|' | grep -o '|' | wc -l

echo "The number of ortholog groups found in V.dahliae race2 but absent in race1 is:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep -v -e 'JR2|' -e 'VaMs102|' | grep '12008|' | grep '51|' | grep '53|' | grep '58|' | grep '61|' | grep 'Ls17|' | wc -l    
echo "This represents the following number of genes:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep -v -e 'JR2|' -e 'VaMs102|' | grep '12008|' | grep '51|' | grep '53|' | grep '58|' | grep '61|' | grep 'Ls17|' | grep -o '|' | wc -l    

echo "The number of ortholog groups found in race 1 strain but absent in race2 is:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep -e 'JR2|' | grep -v -e 'VaMs102|' -e '12008|' -e '51|' -e '53|' -e '58|' -e '61|' -e 'Ls17|' | wc -l  
echo "This represents the following number of genes:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep -e 'JR2|' | grep -v -e 'VaMs102|' -e '12008|' -e '51|' -e '53|' -e '58|' -e '61|' -e 'Ls17|' | grep -o '|' | wc -l 

echo "The number of orthogroups in 12008 but absent in 51 53 58 61 Ls17 JR2 and VaMa102 is:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep -v -e 'JR2|' -e 'VaMs102|' -e 'Ls17|' -e '51|' -e '58|' -e '53|' -e '61|' | grep '12008|' | wc -l 
echo "This represents the following number of genes:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep -v -e 'JR2|' -e 'VaMs102|' -e 'Ls17|' -e '51|' -e '58|' -e '53|' -e '61|' | grep '12008|' | grep -o '|' | wc -l 

echo "The number of orthogroups in 51 but absent in 12008 53 58 61 Ls17 JR2 and VaMa102 is:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep -v -e 'JR2|' -e 'VaMs102|' -e 'Ls17|' -e '12008|' -e '58|' -e '53|' -e '61|' | grep -e '51|' | wc -l 
echo "This represents the following number of genes:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep -v -e 'JR2|' -e 'VaMs102|' -e 'Ls17|' -e '12008|' -e '58|' -e '53|' -e '61|' | grep -e '51|' | grep -o '|'  | wc -l 

echo "The number of orthogroups in 53 but absent in 12008 51 58 61 Ls17 JR2 and VaMa102 is:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep -v -e 'JR2|' -e 'VaMs102|' -e 'Ls17|' -e '12008|' -e '58|' -e '51|' -e '61|' | grep -e '53|' | wc -l 

echo "The number of orthogroups in 58 but absent in 12008 51 53 61 Ls17 JR2 and VaMa102 is:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep -v -e 'JR2|' -e 'VaMs102|' -e 'Ls17|' -e '12008|' -e '53|' -e '51|' -e '61|' | grep -e '58|' | wc -l 

echo "The number of orthogroups in 61 but absent in 12008 51 53 58 Ls17 JR2 and VaMa102 is:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep -v -e 'JR2|' -e 'VaMs102|' -e 'Ls17|' -e '12008|' -e '53|' -e '51|' -e '58|' | grep -e '61|' | wc -l
echo "This represents the following number of genes:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep -v -e 'JR2|' -e 'VaMs102|' -e 'Ls17|' -e '12008|' -e '53|' -e '51|' -e '58|' | grep -e '61|' | grep -o '|' | wc -l

echo "The number of orthogroups in VaMa102 but absent in 12008 51 53 58 Ls17 JR2 and 61 is:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep -v -e 'JR2|' -e '61|' -e 'Ls17|' -e '12008|' -e '53|' -e '51|' -e '58|' | grep -e 'VaMs102|' | wc -l
echo "This represents the following number of genes:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep -v -e 'JR2|' -e '61|' -e 'Ls17|' -e '12008|' -e '53|' -e '51|' -e '58|' | grep -e 'VaMs102|' | grep -o '|' | wc -l

echo "The number of orthogroups in 12008 and JR2 but absent in 51 53 58 61 Ls17 and VaMa102 is:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep -v -e 'VaMs102|' -e 'Ls17|' -e '51|' -e '58|' -e '53|' -e '61|' | grep -e '12008|' -e 'JR2|' | wc -l
echo "This represents the following number of genes:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep -v -e 'VaMs102|' -e 'Ls17|' -e '51|' -e '58|' -e '53|' -e '61|' | grep -e '12008|' -e 'JR2|' | grep -o '|' | wc -l

echo "The number of orthogroups common to UK strains is:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep -v -e 'JR2|' -e 'VaMs102|' -e 'Ls17|' | grep '12008|' | grep '51|' | grep '53|' | grep '58|' | grep '61|' | wc -l    
echo "This represents the following number of genes:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep -v -e 'JR2|' -e 'VaMs102|' -e 'Ls17|' | grep '12008|' | grep '51|' | grep '53|' | grep '58|' | grep '61|' | grep -o '|' | wc -l

echo "The number of orthogroups exist in Ls17 but absent in others is:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep -v -e 'JR2|' -e 'VaMs102|' -e '61|' -e '12008|' -e '51|' -e '53|' -e '58|' | grep 'Ls17|' | wc -l    
echo "This represents the following number of genes:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep -v -e 'JR2|' -e 'VaMs102|' -e '61|' -e '12008|' -e '51|' -e '53|' -e '58|' | grep 'Ls17|' | grep -o '|' | wc -l




echo "The number of orthogroups common to all strains is:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep 'JR2|' | grep 'VaMs102|' | grep 'Ls17|' | grep '12008|' | grep '51|' | grep '53|' | grep '58|' | grep '61|' | wc -l    
echo "This represents the following number of genes:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep 'JR2|' | grep 'VaMs102|' | grep 'Ls17|' | grep '12008|' | grep '51|' | grep '53|' | grep '58|' | grep '61|' | grep -o '|' | wc -l

echo "The number of orthogroups common to 12008 and 51 but absent in 53 58 61 and other strains is:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep -v -e 'JR2|' -e 'VaMs102|' -e 'Ls17|' -e '53' -e '58' -e '61'| grep '12008|' | grep '51|' | wc -l    
echo "This represents the following number of genes:"
cat $WorkDir/"$IsolateAbrv"_orthogroups.txt | grep -v -e 'JR2|' -e 'VaMs102|' -e 'Ls17|' -e '53' -e '58' -e '61'| grep '12008|' | grep '51|' | grep -o '|' | wc -l
done
```

The total number of orthogroups is:
9697
The total number of genes in orthogroups is:
80518
The number of orthogroups common to V.dahliae strains is:
501
This represents the following number of genes:
3639
The number of ortholog groups found in V.dahliae race2 but absent in race1 is:
76
This represents the following number of genes:
463
The number of ortholog groups found in race 1 strain but absent in race2 is:
10
This represents the following number of genes:
18

The number of orthogroups in 12008 but absent in 51 53 58 61 Ls17 JR2 and VaMa102 is:
1
This represents the following number of genes:
16
The 16 genes are:
orthogroup325: 12008|g9019.t1 12008|NS_04525.t1 12008|NS_04524.t1 12008|NS_04499.t1 12008|NS_04496.t1 12008|NS_04485.t1 12008|NS_04376.t1 12008|NS_03994.t1 12008|NS_03801.t1 12008|NS_03575.t1 12008|NS_03328.t1 12008|NS_03238.t1 12008|NS_03079.t1 12008|NS_02608.t1 12008|NS_01929.t1 12008|NS_00324.t1


The number of orthogroups in 12008 and JR2 but absent in 51 53 58 61 Ls17 and VaMa102 is:
20
This represents the following number of genes:
64
These genes are :
orthogroup654: 12008|g536.t1 12008|g9634.t1 JR2|VDAG_JR2_Chr1g01860.p1 12008|g8527.t1 12008|g6811.t1 JR2|VDAG_JR2_Chr2g09590.p1 JR2|VDAG_JR2_Chr2g09600.p1 JR2|VDAG_JR2_Chr6g07190.p1 JR2|VDAG_JR2_Chr1g22550.p1 JR2|VDAG_JR2_Chr1g22560.p1 12008|g5029.t1
orthogroup8778: 12008|g9085.t1 JR2|VDAG_JR2_Chr2g10930.p1 JR2|VDAG_JR2_Chr2g09450.p1 JR2|VDAG_JR2_Chr2g10320.p1
orthogroup8936: 12008|g6810.t1 JR2|VDAG_JR2_Chr2g10300.p1 12008|g8867.t1
orthogroup9223: 12008|g1104.t1 JR2|VDAG_JR2_Chr1g05340.p1
orthogroup9225: 12008|g2083.t1 JR2|VDAG_JR2_Chr3g06510.p1
orthogroup9247: 12008|g7678.t1 JR2|VDAG_JR2_Chr6g10840.p1
orthogroup9250: 12008|g8709.t1 JR2|VDAG_JR2_Chr5g03570.p1
orthogroup9252: 12008|g9349.t1 JR2|VDAG_JR2_Chr2g01540.p1
orthogroup9269: 12008|PGN_CUFF_6898_1_3.t1 JR2|VDAG_JR2_Chr5g08000.p1


The number of orthogroups in 51 but absent in 12008 53 58 61 Ls17 JR2 and VaMa102 is:
1
This represents the following number of genes:
1
This gene is :
orthogroup9695: 51|g7944.t1


The number of orthogroups in 53 but absent in 12008 51 58 61 Ls17 JR2 and VaMa102 is:
0
The number of orthogroups in 58 but absent in 12008 51 53 61 Ls17 JR2 and VaMa102 is:
0

The number of orthogroups in 61 but absent in 12008 51 53 58 Ls17 JR2 and VaMa102 is:
1
This represents the following number of genes:
1
This gene is :
orthogroup9689: 61|g2277.t1

The number of orthogroups in VaMa102 but absent in 12008 51 53 58 Ls17 JR2 and 61 is:
17
This represents the following number of genes (these genes possiably are Va specific or Va-alfafae interaction genes):
25

The number of orthogroups common to UK strains is:
131
This represents the following number of genes (these genes possiably are Vd-strawberry specific interaction genes):
767

The number of orthogroups common to all strains is:
7285
This represents the following number of genes :
67890

The number of orthogroups common to 12008 and 51 but absent in 53 58 61 and other strains is (pathogenicity test results showed that 12008 and 51 are significantly highler than 53 58 61, so these genes probably are high virulence factors. Next step can search them in Effector or CAZy results.)
4
This represents the following number of genes:
8
These genes are
orthogroup9256: 12008|NS_00849.t1 51|NS_03230.t1
orthogroup9262: 12008|NS_03788.t1 51|NS_03150.t1
orthogroup9267: 12008|PGN_07426.t1 51|PGN_01319.t1
orthogroup9272: 12008|PGN_CUFF_10127_1_1.t1 51|PGN_CUFF_7021_1_1.t1

The number of orthogroups exist in Ls17 but absent in others is:
3
This represents the following number of genes (these genes possiably are Vd-lettucespecific interaction genes):
4
these genes are 
orthogroup9402: Ls17|EGY20899 Ls17|EGY23784
orthogroup9688: Ls17|EGY22724
orthogroup9697: Ls17|EGY19619



## 4.5.b Plot venn diagrams:
Note that the venn can only run with up to 5 genomes once.

```bash
  ProgDir=/home/adamst/git_repos/scripts/fusarium/pathogen/orthology
  $ProgDir/FoC_path_vs_non_path_venn_diag.r --inp $WorkDir/"$IsolateAbrv"_orthogroups.tab --out $WorkDir/"$IsolateAbrv"_orthogroups.pdf
```
Error in library(optparse) : there is no package called ‘optparse’
Execution halted

## 4.6.a Extracting fasta files orthogroups
```bash
  ProgDir=~/git_repos/tools/pathogen/orthology/orthoMCL
  OrthogroupTxt=analysis/orthology/orthomcl/$IsolateAbrv/"$IsolateAbrv"_orthogroups.txt
  GoodProt=analysis/orthology/orthomcl/$IsolateAbrv/goodProteins/goodProteins.fasta
  OutDir=analysis/orthology/orthomcl/$IsolateAbrv/fasta/all_orthogroups
  mkdir -p $OutDir
  $ProgDir/orthoMCLgroups2fasta.py --orthogroups $OrthogroupTxt --fasta $GoodProt --out_dir $OutDir > $OutDir/extractionlog.txt
```



    





 